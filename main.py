import os
from datetime import datetime
from telegram import (
    Update,
    InlineKeyboardButton,
    InlineKeyboardMarkup
)
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    MessageHandler,
    CallbackQueryHandler,
    ContextTypes,
    filters
)

BOT_TOKEN = os.getenv("BOT_TOKEN")
ADMIN_ID = int(os.getenv("ADMIN_ID"))

DEADLINE = datetime(2026, 1, 8, 23, 59)

TEXTS = {
    "ru": {
        "choose_lang": "ÐŸÑ€Ð¸Ð²ÐµÑ‚! ðŸ‘‹\n\nÐ’Ñ‹Ð±ÐµÑ€Ð¸ ÑÐ·Ñ‹Ðº:",
        "rules": (
            "ðŸŽ„ ÐšÐ¾Ð½ÐºÑƒÑ€Ñ Â«Bear of The YearÂ»\n\n"
            "Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð° ÐºÐ¾Ð½ÐºÑƒÑ€Ñ Â«ÐœÐµÐ´Ð²ÐµÐ´ÑŒ Ð³Ð¾Ð´Ð°Â».\n"
            "Ð’Ð°Ð¼ Ð´Ð¾ÑÑ‚Ð°Ð»ÑÑ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼ÐµÐ´Ð²ÐµÐ´ÑŒ â€” Ñ‚ÐµÐ¿ÐµÑ€ÑŒ ÐµÐ³Ð¾ ÑÑƒÐ´ÑŒÐ±Ð° Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð² Ð²Ð°ÑˆÐ¸Ñ… Ñ€ÑƒÐºÐ°Ñ….\n\n"
            "Ð Ð°ÑÐºÑ€Ð°ÑˆÐ¸Ð²Ð°Ð¹Ñ‚Ðµ, ÑƒÐ»ÑƒÑ‡ÑˆÐ°Ð¹Ñ‚Ðµ, Ð»Ð¾Ð¼Ð°Ð¹Ñ‚Ðµ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹.\n"
            "ÐœÐ¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð»ÑŽÐ±Ñ‹Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹: ÐºÑ€Ð°ÑÐºÐ¸, Ð¼Ð°Ñ€ÐºÐµÑ€Ñ‹, ÑÑ‚Ñ€Ð°Ð·Ñ‹, Ð»Ð°Ðº Ð¸ Ð²ÑÑ‘, Ð½Ð° Ñ‡Ñ‚Ð¾ Ñ…Ð²Ð°Ñ‚Ð¸Ñ‚ Ñ„Ð°Ð½Ñ‚Ð°Ð·Ð¸Ð¸.\n\n"
            "Ð”Ð»Ñ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ñ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð·Ð°Ð³Ð»ÑÐ½ÑƒÑ‚ÑŒ ÑÑŽÐ´Ð°:\n"
            "https://google.com/beag/bor\n\n"
            "Ð¡ 9 Ð¿Ð¾ 11 ÑÐ½Ð²Ð°Ñ€Ñ Ð¿Ñ€Ð¾Ð¹Ð´Ñ‘Ñ‚ Ð°Ð½Ð¾Ð½Ð¸Ð¼Ð½Ð¾Ðµ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ.\n"
            "13 ÑÐ½Ð²Ð°Ñ€Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾Ð´Ð½Ð¸Ð¹ ÑÑƒÐ¿ÐµÑ€Ð¿Ñ€Ð¸Ð· Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚:\n"
            "â€” ðŸ† Ð¡Ð°Ð¼Ñ‹Ð¹ ÐºÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹ Ð¼ÐµÐ´Ð²ÐµÐ´ÑŒ\n"
            "â€” ðŸŒ€ Ð¡Ð°Ð¼Ñ‹Ð¹ Ð±ÐµÐ·ÑƒÐ¼Ð½Ñ‹Ð¹ Ð¼ÐµÐ´Ð²ÐµÐ´ÑŒ\n\n"
            "Ð­Ñ‚Ð¾ Ð½Ðµ ÐºÐ¾Ð½ÐºÑƒÑ€Ñ Ñ…ÑƒÐ´Ð¾Ð¶Ð½Ð¸ÐºÐ¾Ð².\n"
            "Ð­Ñ‚Ð¾ ÐºÐ¾Ð½ÐºÑƒÑ€Ñ Ñ„Ð°Ð½Ñ‚Ð°Ð·Ð¸Ð¸, Ð½Ð°Ð³Ð»Ð¾ÑÑ‚Ð¸ Ð¸ ÑÐ¾Ð¼Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹.\n\n"
            "Ð§Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ:\n"
            "1) Ð Ð°ÑÐºÑ€Ð°ÑÐ¸Ñ‚ÑŒ Ð¼ÐµÐ´Ð²ÐµÐ´Ñ â€” ÑÑ‚Ð¸Ð»ÑŒÐ½Ð¾ Ð¸Ð»Ð¸ Ð±ÐµÐ·ÑƒÐ¼Ð½Ð¾, Ñ€ÐµÑˆÐ°Ñ‚ÑŒ Ñ‚ÐµÐ±Ðµ\n"
            "2) Ð”Ð°Ñ‚ÑŒ Ð¼ÐµÐ´Ð²ÐµÐ´ÑŽ Ð¸Ð¼Ñ Ð¸ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ Ñ‚Ð¸Ñ‚ÑƒÐ»\n"
            "3) ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾ Ð¼ÐµÐ´Ð²ÐµÐ´Ñ, ÐµÐ³Ð¾ Ð¸Ð¼Ñ Ð¸ Ñ‚Ð¸Ñ‚ÑƒÐ» Ð² ÑÑ‚Ð¾Ñ‚ Ñ‡Ð°Ñ‚\n\n"
            "Ð Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¿ÑƒÐ±Ð»Ð¸ÐºÑƒÑŽÑ‚ÑÑ Ð°Ð½Ð¾Ð½Ð¸Ð¼Ð½Ð¾.\n"
            "â° Ð”ÐµÐ´Ð»Ð°Ð¹Ð½: 9 ÑÐ½Ð²Ð°Ñ€Ñ Ð² 00:01.\n\n"
            "Ð’ÑÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð±ÑƒÐ´ÑƒÑ‚ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ñ‹ Ð² ÐºÐ°Ð½Ð°Ð»Ðµ:\n"
            "t.me/boty2026\n\n"
            "ÐŸÐ¾ÐµÑ…Ð°Ð»Ð¸ ðŸ»âœ¨"
        ),
        "accepted": (
            "âœ… ÐœÐµÐ´Ð²ÐµÐ´ÑŒ Ð¿Ñ€Ð¸Ð½ÑÑ‚. Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ ðŸ»\n\n"
            "Ð•ÑÐ»Ð¸ Ñ‚Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ð» Ð²ÑÐµ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ, Ð½Ðµ Ð·Ð°Ð±ÑƒÐ´ÑŒ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° ÐºÐ°Ð½Ð°Ð»:\n"
            "t.me/boty2026\n\n"
            "Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð¹Ð´Ñ‘Ñ‚ 9 ÑÐ½Ð²Ð°Ñ€Ñ â€” Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ð¾ÑƒÑ‡Ð°ÑÑ‚Ð²ÑƒÐ¹.\n\n"
            "Ð•ÑÐ»Ð¸ Ñ‚Ñ‹ ÐµÑ‰Ñ‘ Ð½Ðµ Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð» Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ, Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾, Ð¸Ð¼Ñ Ð¸ Ñ‚Ð¸Ñ‚ÑƒÐ» ÐµÑ‰Ñ‘ Ñ€Ð°Ð·."
        ),
        "closed": "âŒ ÐŸÑ€Ð¸Ñ‘Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½."
    },
    "th": {
        "choose_lang": "à¸ªà¸§à¸±à¸ªà¸”à¸µ ðŸ‘‹\n\nà¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸ à¸²à¸©à¸²:",
        "rules": (
            "ðŸŽ„ à¸à¸²à¸£à¸›à¸£à¸°à¸à¸§à¸” Â«Bear of The YearÂ»\n\n"
            "à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸ªà¸¹à¹ˆà¸à¸²à¸£à¹à¸‚à¹ˆà¸‡à¸‚à¸±à¸™ â€œà¸«à¸¡à¸µà¹à¸«à¹ˆà¸‡à¸›à¸µâ€\n"
            "à¸„à¸¸à¸“à¹„à¸”à¹‰à¸£à¸±à¸šà¸«à¸¡à¸µà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹€à¸«à¸¡à¸·à¸­à¸™à¹ƒà¸„à¸£ à¹à¸¥à¸°à¸•à¸­à¸™à¸™à¸µà¹‰à¸Šà¸°à¸•à¸²à¸à¸£à¸£à¸¡à¸‚à¸­à¸‡à¸¡à¸±à¸™à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸¡à¸·à¸­à¸„à¸¸à¸“à¹à¸¥à¹‰à¸§\n\n"
            "à¸•à¸à¹à¸•à¹ˆà¸‡ à¸£à¸°à¸šà¸²à¸¢à¸ªà¸µ à¸—à¸³à¸¥à¸²à¸¢à¸à¸£à¸­à¸šà¹€à¸”à¸´à¸¡ à¹† à¹„à¸”à¹‰à¹€à¸•à¹‡à¸¡à¸—à¸µà¹ˆ\n"
            "à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸§à¸±à¸ªà¸”à¸¸à¸­à¸°à¹„à¸£à¸à¹‡à¹„à¸”à¹‰: à¸ªà¸µ à¸›à¸²à¸à¸à¸² à¸à¸²à¸à¹€à¸žà¸Šà¸£ à¹à¸¥à¸„à¹€à¸à¸­à¸£à¹Œ à¸«à¸£à¸·à¸­à¸­à¸°à¹„à¸£à¸à¹‡à¸•à¸²à¸¡à¸—à¸µà¹ˆà¸ˆà¸´à¸™à¸•à¸™à¸²à¸à¸²à¸£à¸žà¸²à¹„à¸›\n\n"
            "à¸«à¸²à¸à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹à¸£à¸‡à¸šà¸±à¸™à¸”à¸²à¸¥à¹ƒà¸ˆ à¸¥à¸­à¸‡à¸”à¸¹à¸—à¸µà¹ˆà¸¥à¸´à¸‡à¸à¹Œà¸™à¸µà¹‰:\n"
            "https://google.com/beag/bor\n\n"
            "à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ 9â€“11 à¸¡à¸à¸£à¸²à¸„à¸¡ à¸ˆà¸°à¸¡à¸µà¸à¸²à¸£à¹‚à¸«à¸§à¸•à¹à¸šà¸šà¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸à¸•à¸±à¸§à¸•à¸™\n"
            "à¹à¸¥à¸°à¹ƒà¸™à¸§à¸±à¸™à¸—à¸µà¹ˆ 13 à¸¡à¸à¸£à¸²à¸„à¸¡ à¸ˆà¸°à¸¡à¸µà¸£à¸²à¸‡à¸§à¸±à¸¥à¸›à¸µà¹ƒà¸«à¸¡à¹ˆà¸ªà¸³à¸«à¸£à¸±à¸š:\n"
            "â€” ðŸ† à¸«à¸¡à¸µà¸—à¸µà¹ˆà¸ªà¸§à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”\n"
            "â€” ðŸŒ€ à¸«à¸¡à¸µà¸—à¸µà¹ˆà¸šà¹‰à¸²à¸„à¸¥à¸±à¹ˆà¸‡à¸—à¸µà¹ˆà¸ªà¸¸à¸”\n\n"
            "à¸™à¸µà¹ˆà¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸à¸²à¸£à¸›à¸£à¸°à¸à¸§à¸”à¸¨à¸´à¸¥à¸›à¸´à¸™\n"
            "à¹à¸•à¹ˆà¸¡à¸±à¸™à¸„à¸·à¸­à¸à¸²à¸£à¸›à¸£à¸°à¸à¸§à¸”à¸ˆà¸´à¸™à¸•à¸™à¸²à¸à¸²à¸£ à¸„à¸§à¸²à¸¡à¸à¸¥à¹‰à¸² à¹à¸¥à¸°à¸à¸²à¸£à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¸—à¸µà¹ˆà¸™à¹ˆà¸²à¸ªà¸‡à¸ªà¸±à¸¢\n\n"
            "à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³:\n"
            "1) à¸•à¸à¹à¸•à¹ˆà¸‡à¸«à¸¡à¸µ â€” à¸ˆà¸°à¸ªà¸§à¸¢à¸«à¸£à¸·à¸­à¸ˆà¸°à¹€à¸žà¸µà¹‰à¸¢à¸™à¸à¹‡à¹à¸¥à¹‰à¸§à¹à¸•à¹ˆà¸„à¸¸à¸“\n"
            "2) à¸•à¸±à¹‰à¸‡à¸Šà¸·à¹ˆà¸­à¹à¸¥à¸°à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹ƒà¸«à¹‰à¸à¸±à¸šà¸«à¸¡à¸µà¸‚à¸­à¸‡à¸„à¸¸à¸“\n"
            "3) à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸«à¸¡à¸µ à¸žà¸£à¹‰à¸­à¸¡à¸Šà¸·à¹ˆà¸­à¹à¸¥à¸°à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸¡à¸²à¸—à¸µà¹ˆà¹à¸Šà¸—à¸™à¸µà¹‰\n\n"
            "à¸œà¸¥à¸‡à¸²à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸ˆà¸°à¸–à¸¹à¸à¹€à¸œà¸¢à¹à¸žà¸£à¹ˆà¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¹€à¸›à¸´à¸”à¹€à¸œà¸¢à¸•à¸±à¸§à¸•à¸™\n"
            "â° à¸«à¸¡à¸”à¹€à¸‚à¸•: à¸§à¸±à¸™à¸—à¸µà¹ˆ 9 à¸¡à¸à¸£à¸²à¸„à¸¡ à¹€à¸§à¸¥à¸² 00:01\n\n"
            "à¸œà¸¥à¸‡à¸²à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸ˆà¸°à¸–à¸¹à¸à¹‚à¸žà¸ªà¸•à¹Œà¹ƒà¸™à¸Šà¹ˆà¸­à¸‡:\n"
            "t.me/boty2026\n\n"
            "à¹€à¸£à¸´à¹ˆà¸¡à¹„à¸”à¹‰à¹€à¸¥à¸¢ ðŸ»âœ¨"
        ),
        "accepted": (
            "âœ… à¸£à¸±à¸šà¸œà¸¥à¸‡à¸²à¸™à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢ à¸‚à¸­à¸šà¸„à¸¸à¸“ ðŸ»\n\n"
            "à¸–à¹‰à¸²à¸„à¸¸à¸“à¸—à¸³à¸„à¸£à¸šà¸—à¸¸à¸à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¹à¸¥à¹‰à¸§ à¸­à¸¢à¹ˆà¸²à¸¥à¸·à¸¡à¸•à¸´à¸”à¸•à¸²à¸¡à¸Šà¹ˆà¸­à¸‡:\n"
            "t.me/boty2026\n\n"
            "à¸à¸²à¸£à¹‚à¸«à¸§à¸•à¸ˆà¸°à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸™à¸§à¸±à¸™à¸—à¸µà¹ˆ 9 à¸¡à¸à¸£à¸²à¸„à¸¡ à¸­à¸¢à¹ˆà¸²à¸¥à¸·à¸¡à¸¡à¸²à¸£à¹ˆà¸§à¸¡à¹‚à¸«à¸§à¸•à¸™à¸°\n\n"
            "à¸«à¸²à¸à¸„à¸¸à¸“à¸¢à¸±à¸‡à¸—à¸³à¸œà¸¥à¸‡à¸²à¸™à¹„à¸¡à¹ˆà¹€à¸ªà¸£à¹‡à¸ˆ à¸ªà¸²à¸¡à¸²à¸£à¸–à¸ªà¹ˆà¸‡à¸£à¸¹à¸› à¸Šà¸·à¹ˆà¸­ à¹à¸¥à¸°à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸¡à¸²à¹ƒà¸«à¸¡à¹ˆà¹„à¸”à¹‰à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡"
        ),
        "closed": "âŒ à¸›à¸´à¸”à¸£à¸±à¸šà¸œà¸¥à¸‡à¸²à¸™à¹à¸¥à¹‰à¸§"
    }
}

def language_keyboard():
    return InlineKeyboardMarkup([
        [
            InlineKeyboardButton("Ð ÑƒÑÑÐºÐ¸Ð¹ ðŸ‡·ðŸ‡º", callback_data="lang_ru"),
            InlineKeyboardButton("à¹„à¸—à¸¢ ðŸ‡¹ðŸ‡­", callback_data="lang_th")
        ]
    ])

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data.clear()
    await update.message.reply_text(
        TEXTS["ru"]["choose_lang"],
        reply_markup=language_keyboard()
    )

async def change_language(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "Choose language / à¹€à¸¥à¸·à¸­à¸à¸ à¸²à¸©à¸²",
        reply_markup=language_keyboard()
    )

async def set_language(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    lang = query.data.split("_")[1]
    context.user_data["lang"] = lang

    await query.message.reply_text(TEXTS[lang]["rules"])

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if "lang" not in context.user_data:
        await update.message.reply_text(
            TEXTS["ru"]["need_lang"],
            reply_markup=language_keyboard()
        )
        return

    lang = context.user_data["lang"]

    if datetime.now() > DEADLINE:
        await update.message.reply_text(TEXTS[lang]["closed"])
        return

    await context.bot.forward_message(
        chat_id=ADMIN_ID,
        from_chat_id=update.message.chat_id,
        message_id=update.message.message_id
    )

    await update.message.reply_text(TEXTS[lang]["accepted"])

def main():
    app = ApplicationBuilder().token(BOT_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("language", change_language))
    app.add_handler(CallbackQueryHandler(set_language, pattern="^lang_"))
    app.add_handler(MessageHandler(filters.ALL, handle_message))

    print("Bot started...")
    app.run_polling()

if __name__ == "__main__":
    main()
